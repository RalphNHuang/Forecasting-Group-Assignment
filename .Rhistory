plot(stability(var_store_3, type = "OLS-CUSUM"))
plot(stability(var_store_3, type = "Score-MOSUM"))
plot(stability(var_store_3, type = "Rec-CUSUM"))
plot(stability(var_store_3, type = "Rec-MOSUM"))
plot(stability(var_cat_1, type = "Rec-MOSUM"))
summary(var_cat_1)
var_store_2_pred = predict(var_store_2, n.ahead = 1, ci = 0.95)
var_store_3_pred = predict(var_store_3, n.ahead = 1, ci = 0.95)
var_cat_2 = VAR(trainData[,cat_2], type = "none", p = 7)
plot(stability(var_cat_2, type = "RE"))
summary(var_cat_2)
var_cat_3 = VAR(trainData[,cat_3], type = "none", p = 7)
plot(stability(var_cat_3, type = "RE"))
par("mar")
par(mar = c(1, 1, 1, 1))
plot(stability(var_cat_3, type = "OLS-CUSUM"))
summary(var_cat_3)
var_cat_1_pred = predict(var_cat_1, n.ahead = 1, ci = 0.95)
var_cat_2_pred = predict(var_cat_2, n.ahead = 1, ci = 0.95)
var_cat_3_pred = predict(var_cat_3, n.ahead = 1, ci = 0.95)
plot(stability(var_all, type = "OLS-CUSUM"))
var_all_pred = predict(var_all, n.ahead = 1, ci = 0.95)
var_all_pred
pred_list$Hobbies_CA_1
pred_list$Hobbies_CA_1$fitted
library(tidyverse)
<<<<<<< HEAD
col_raw = read_csv("./dat/Projectdata.csv")
install.packages("tseries")
knitr::opts_chunk$set(echo = TRUE)
library(tseries)
adf.test(rawData$Hobbies_CA_1)
library(tidyverse)
rawData = read_csv("./dat/Projectdata.csv")
library(tseries)
adf.test(rawData$Hobbies_CA_1)
adf.test(rawData$Hobbies_CA_2)
library(tseries)
adf.test(rawData$Hobbies_CA_1)
adf.test(rawData$Hobbies_CA_2)
colnames(rawData)
par(mfrow=c(3,2))
acf(rawData$Hobbies_CA_1)
pacf(rawData$Hobbies_CA_1)
acf(rawData$Hobbies_CA_2)
pacf(rawData$Hobbies_CA_2)
acf(rawData$Hobbies_CA_3)
pacf(rawData$Hobbies_CA_3)
par(mfrow=c(3,2))
acf(rawData$Household_1_CA_1)
pacf(rawData$Household_1_CA_1)
acf(rawData$Household_1_CA_2)
pacf(rawData$Household_1_CA_2)
acf(rawData$Household_1_CA_3)
pacf(rawData$Household_1_CA_3)
par(mfrow=c(3,2))
acf(rawData$Household_2_CA_1)
pacf(rawData$Household_2_CA_1)
acf(rawData$Household_2_CA_2)
pacf(rawData$Household_2_CA_2)
acf(rawData$Household_2_CA_3)
pacf(rawData$Household_2_CA_3)
par(mfrow=c(3,2))
acf(rawData$Foods_1_CA_1)
pacf(rawData$Foods_1_CA_1)
acf(rawData$Foods_1_CA_2)
pacf(rawData$Foods_1_CA_2)
acf(rawData$Foods_1_CA_3)
pacf(rawData$Foods_1_CA_3)
par(mfrow=c(3,2))
acf(rawData$Foods_2_CA_1)
pacf(rawData$Foods_2_CA_1)
acf(rawData$Foods_2_CA_2)
pacf(rawData$Foods_2_CA_2)
acf(rawData$Foods_2_CA_3)
pacf(rawData$Foods_2_CA_3)
par(mfrow=c(3,2))
acf(rawData$Foods_3_CA_1)
pacf(rawData$Foods_3_CA_1)
acf(rawData$Foods_3_CA_2)
pacf(rawData$Foods_3_CA_2)
acf(rawData$Foods_3_CA_3)
pacf(rawData$Foods_3_CA_3)
library(tseries)
adf.test(rawData$Hobbies_CA_1)
adf.test(rawData$Hobbies_CA_2)
adf.test(rawData$Hobbies_CA_3)
library(tseries)
adf.test(rawData$Household_1_CA_1)
adf.test(rawData$Household_1_CA_2)
adf.test(rawData$Household_1_CA_3)
<<<<<<< Updated upstream
install.packages("TBATS")
install.packages("forecast")
library(forecast)
View(rawData)
library(tidyverse)
rawData$date %>% as.POSIXct.Date()
nrow(rawData)-28
### Dataset splition
trainData = rawData[c(1:(nrow(rawData)-28)),]
testData = rawData[c((nrow(rawData)-27):nrow(rawData)),]
rawData$date[1]
as.POSIXct.Date(rawData$date[1])
as.POSIXct.Date(rawData$date[1]) %>% year()
hobby_ts_1 = ts(trainData$Hobbies_CA_1, start = 1)
plot(hobby_ts_1)
tbats_hobby_1 = tbats(hobby_ts_1)
predict(tbats_hobby_1)
tbats_hobby_1_pred = forecast(tbats_hobby_1, level = c(95), h = 28)
plot(tbats_hobby_1_pred)
tbats_hobby_1_pred
hobby_ts_1 = msts(trainData$Hobbies_CA_1, start = 1, ts.frequency = c(7,30.4, 365.25))
hobby_ts_1 = msts(trainData$Hobbies_CA_1, start = 1, seasonal.periods =  = c(7,30.4, 365.25))
hobby_ts_1 = msts(trainData$Hobbies_CA_1, start = 1, seasonal.periods = c(7,30.4, 365.25))
plot(hobby_ts_1)
tbats_hobby_1 = tbats(hobby_ts_1)
tbats_hobby_1_pred = forecast(tbats_hobby_1, level = c(95), h = 28)
plot(tbats_hobby_1_pred)
tbats_hobby_1_pred
tbats_hobby_1_pred$fitted
tbats_hobby_1_pred$fitted[1942:1969]
tbats_hobby_1_pred$series
tbats_hobby_1_pred$fitted %>% length()
tbats_hobby_1_pred$upper
tbats_hobby_1_pred$method
tbats_hobby_1_pred$mean
c(1,2)^2
cal.devisor = function(ts_vector){
tmp = ts_vector[2:length(ts_vector)]-ts_vector[1:(length(ts_vector)-1)]
output = sum(tmp^2)/(length(ts_vector)-1)
return(output)
}
cal.RMSSE = function(pred, origin, devisor){
if(length(pred) != length(origin)){
cat("lengthError: please keep the length of pred and the length of origin consistent")
}
else{
output = sqrt(sum((pred - origin)^2)/(devisor*length(pred)))
return(output)
}
}
cal.RMSSE(tbats_hobby_1_pred$mean, testData$Hobbies_CA_1, cal.devisor(trainData$Hobbies_CA_1))
hobby_ts_1 = msts(trainData$Hobbies_CA_1, start = 1)
hobby_ts_1 = ts(trainData$Hobbies_CA_1, start = 1)
plot(hobby_ts_1)
tbats_hobby_1 = tbats(hobby_ts_1)
tbats_hobby_1_pred = forecast(tbats_hobby_1, level = c(95), h = 28)
plot(tbats_hobby_1_pred)
tbats_hobby_1_pred$mean
cal.RMSSE(tbats_hobby_1_pred$mean, testData$Hobbies_CA_1, cal.devisor(trainData$Hobbies_CA_1))
msts.beta = function(column){
output = msts(column, start = 1, seasonal.periods = c(7, 30.4, 365.25))
return(output)
}
=======
pred_list$Hobbies_CA_1$fitted %>% length()
tbats_list$Hobbies_CA_1$errors
tbats_list$Hobbies_CA_1$parameters %>% summary()
tbats_list$Hobbies_CA_1 %>% summary()
save(ts_list, file = "./RData/ralph.RData")
source("./R/utils.R")
source("./R/dataUtils.R")
>>>>>>> 93591b85bd93c80e518447fe317b510cb23415bb
ts_list = lapply(trainData[,2:ncol(rawData)], msts.beta)
tbats_list = lapply(ts_list, tbats)
### same as the predicting process
pred_list = lapply(tbats_list, forecast.beta)
### same as the predicting process
tbats_pred_list = lapply(tbats_list, forecast.beta)
### calculate the devisors for RMSSE
devisors = unlist(lapply(trainData[,2:ncol(trainData)], cal.devisor))
### calculate the RMSSE for all columns
tbats_RMSSE_v = eval.RMSSE(testData, pred_list, devisor = devisors)
tbats_crossH_RMSSE = data.frame()
for (h in 1:28) {
pred_list = lapply(tbats_list, forecast.beta, h = h)
tbats_RMSSE_v = eval.RMSSE(testData, pred_list, h = h, devisor = devisors)
tbats_crossH_RMSSE = rbind(tbats_crossH_RMSSE, tbats_RMSSE_v)
}
names(tbats_crossH_RMSSE) = names(tbats_RMSSE_v)
cat_ts_list = lapply(trainAggCat[,2:ncol(trainAggCat)], msts.beta)
cat_tbats_list = lapply(cat_ts_list, tbats)
cat_pred_list = lapply(cat_ts_list, forecast.beta)
cat_devisors = unlist(lapply(trainAggCat[,2:ncol(trainAggCat)], cal.devisor))
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, cat_pred_list, devisor = cat_devisors)
# 1.4 aggregate by store
store_ts_list = lapply(trainAggStore[,2:ncol(trainAggStore)], msts.beta)
store_tbats_list = lapply(store_ts_list, tbats)
store_pred_list = lapply(store_ts_list, forecast.beta)
store_devisors = unlist(lapply(trainAggStore[,2:ncol(trainAggStore)], cal.devisor))
store_tbats_RMSSE_v = eval.RMSSE(testAggStore, store_pred_list, devisor = store_devisors)
# 1.5 aggregate by week
week_ts_list = lapply(trainAggWeek[,2:ncol(trainAggWeek)], msts.beta)
week_tbats_list = lapply(week_ts_list, tbats)
week_pred_list = lapply(week_ts_list, forecast.beta, h = 4)
week_devisors = unlist(lapply(trainAggWeek[,2:ncol(trainAggWeek)], cal.devisor))
week_tbats_RMSSE_v = eval.RMSSE(testAggWeek, week_pred_list, h = 4, devisor = week_devisors)
# function to calculate MSE
## 输入：
## pred：预测值
## target：实际值
cal.MSE = function(pred, target){
mse = mean((pred-target)^2, rm.na = T)
return(mse)
}
cal.MSE(pred_list$Hobbies_CA_1$mean, trainData$Hobbies_CA_1)
cal.MSE(pred_list$Hobbies_CA_1$mean, testData$Hobbies_CA_1)
cal.MSE(pred_list$Hobbies_CA_1$fitted, trainData$Hobbies_CA_1)
store_tbats_pred_list = lapply(store_ts_list, forecast.beta)
cat_tbats_pred_list = lapply(cat_ts_list, forecast.beta)
week_tbats_pred_list = lapply(week_ts_list, forecast.beta, h = 4)
#重要！导入所有函数，需要tidyverse包
source("./R/utils.R")
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
}
if(mode=="test"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
}
}
}
tbats_MSE_train_v = eval.MSE(trainData, tbats_pred_list, mode = "train")
tbats_MSE_train_v
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
}
if(mode=="test"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
}
else
cat("please check the mode\n")
}
return(output)
}
tbats_MSE_train_v = eval.MSE(trainData, tbats_pred_list, mode = "train")
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
}
else if(mode=="test"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
}
else
cat("please check the mode\n")
}
return(output)
}
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
return(output)
}
else if(mode=="test"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
return(output)
}
else
cat("please check the mode\n")
}
}
tbats_MSE_train_v = eval.MSE(trainData, tbats_pred_list, mode = "train")
tbats_MSE_train_v
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
return(output)
}
else if(mode=="test"){
output = numeric()
for (i in length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
return(output)
}
else
cat("please check the mode\n")
}
}
tbats_MSE_train_v = eval.MSE(trainData, tbats_pred_list, mode = "train")
tbats_MSE_train_v
i
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
return(output)
}
else if(mode=="test"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.MSE(pred, origin))
}
return(output)
}
else
cat("please check the mode\n")
}
}
tbats_MSE_train_v = eval.MSE(trainData, tbats_pred_list, mode = "train")
tbats_MSE_train_v
tbats_MSE_test_v = eval.MSE(testData, tbats_pred_list, mode = "test")
tbats_MSE_test_v
# function to calculate RMSE
## 输入：
## pred：预测值
## origin：实际值
cal.RMSE = function(pred, origin){
rmse = sqrt(mean((pred-origin)^2, rm.na = T))
return(mse)
}
eval.MSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.RMSE(pred, origin))
}
return(output)
}
else if(mode=="test"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.RMSE(pred, origin))
}
return(output)
}
else
cat("please check the mode\n")
}
}
tbats_RMSE_train_v = eval.MSE(trainData, tbats_pred_list, mode = "train")
tbats_RMSE_test_v = eval.MSE(testData, tbats_pred_list, mode = "test")
tbats_RMSE_train_v = eval.RMSE(trainData, tbats_pred_list, mode = "train")
eval.RMSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.RMSE(pred, origin))
}
return(output)
}
else if(mode=="test"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.RMSE(pred, origin))
}
return(output)
}
else
cat("please check the mode\n")
}
}
tbats_RMSE_train_v = eval.RMSE(trainData, tbats_pred_list, mode = "train")
# function to calculate RMSE
## 输入：
## pred：预测值
## origin：实际值
cal.RMSE = function(pred, origin){
rmse = sqrt(mean((pred-origin)^2, rm.na = T))
return(rmse)
}
eval.RMSE = function(testData, pred_list, mode = "train"){
testData = testData[,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
if(mode=="train"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["fitted"]]
origin = pull(testData, i)
output = c(output, cal.RMSE(pred, origin))
}
return(output)
}
else if(mode=="test"){
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.RMSE(pred, origin))
}
return(output)
}
else
cat("please check the mode\n")
}
}
tbats_RMSE_train_v = eval.RMSE(trainData, tbats_pred_list, mode = "train")
tbats_RMSE_test_v = eval.RMSE(testData, tbats_pred_list, mode = "test")
tbats_RMSE_train_v
tbats_RMSE_test_v
apply(rawData[,2:ncol(rawData)], 2, scale)
source("./R/utils.R")
source("./R/dataUtils.R")
### Dataset splition
rawData = read_csv("./dat/Projectdata.csv")
rawData[,2:ncol(rawData)] = apply(rawData[,2:ncol(rawData)], 2, scale)
trainData = rawData[c(1:(nrow(rawData)-28)),]
testData = rawData[c((nrow(rawData)-27):nrow(rawData)),]
### Aggregation
# by categories
trainAggCat = agg_by_cat(trainData)
testAggCat = agg_by_cat(testData)
# by week
trainAggWeek = agg_by_week(trainData)
testAggWeek = agg_by_week(testData)
# by store
trainAggStore = agg_by_store(trainData)
testAggStore = agg_by_store(testData)
save(rawData, testAggCat, testAggStore, testAggWeek, testData,
trainAggCat, trainAggStore, trainAggWeek, trainData,
file = "./RData/dataset.RData")
tbats_ts_list = lapply(trainData[,2:ncol(rawData)], msts.beta)
# ---------------------------------------------------------------------------
# 对于我的tbats模型，没有什么其他参数需要自定义
# 如果大家的模型有别的参数要传，也可以按照我function.beta()来自定义
# ---------------------------------------------------------------------------
tbats_list = lapply(ts_list, tbats)
### same as the predicting process
tbats_pred_list = lapply(tbats_list, forecast.beta)
### calculate the devisors for RMSSE
devisors = unlist(lapply(trainData[,2:ncol(trainData)], cal.devisor))
### calculate the RMSSE for all columns (h =28)
tbats_RMSSE_v = eval.RMSSE(testData, tbats_pred_list, devisor = devisors)
### calcualte the MES for both train set and test set
tbats_RMSE_train_v = eval.RMSE(trainData, tbats_pred_list, mode = "train")
tbats_RMSE_test_v = eval.RMSE(testData, tbats_pred_list, mode = "test")
# 1.3 evaluate different h
tbats_crossH_RMSSE = data.frame()
for (h in 1:28) {
pred_list = lapply(tbats_list, forecast.beta, h = h)
tbats_RMSSE_v = eval.RMSSE(testData, tbats_pred_list, h = h, devisor = devisors)
tbats_crossH_RMSSE = rbind(tbats_crossH_RMSSE, tbats_RMSSE_v)
}
names(tbats_crossH_RMSSE) = names(tbats_RMSSE_v)
# 1.4 aggregate by item
cat_ts_list = lapply(trainAggCat[,2:ncol(trainAggCat)], msts.beta)
cat_tbats_list = lapply(cat_ts_list, tbats)
cat_tbats_pred_list = lapply(cat_ts_list, forecast.beta)
cat_devisors = unlist(lapply(trainAggCat[,2:ncol(trainAggCat)], cal.devisor))
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, cat_pred_list, devisor = cat_devisors)
# 1.4 aggregate by store
store_ts_list = lapply(trainAggStore[,2:ncol(trainAggStore)], msts.beta)
store_tbats_list = lapply(store_ts_list, tbats)
store_tbats_pred_list = lapply(store_ts_list, forecast.beta)
store_devisors = unlist(lapply(trainAggStore[,2:ncol(trainAggStore)], cal.devisor))
store_tbats_RMSSE_v = eval.RMSSE(testAggStore, store_pred_list, devisor = store_devisors)
# 1.5 aggregate by week
week_ts_list = lapply(trainAggWeek[,2:ncol(trainAggWeek)], msts.beta)
week_tbats_list = lapply(week_ts_list, tbats)
week_tbats_pred_list = lapply(week_ts_list, forecast.beta, h = 4)
week_devisors = unlist(lapply(trainAggWeek[,2:ncol(trainAggWeek)], cal.devisor))
week_tbats_RMSSE_v = eval.RMSSE(testAggWeek, week_pred_list, h = 4, devisor = week_devisors)
store_ts_list = lapply(trainAggStore[,2:ncol(trainAggStore)], msts.beta)
store_tbats_pred_list = lapply(store_ts_list, forecast.beta)
store_tbats_pred_list
ts_list = lapply(trainData[,2:ncol(rawData)], msts.beta)
# ---------------------------------------------------------------------------
# 对于我的tbats模型，没有什么其他参数需要自定义
# 如果大家的模型有别的参数要传，也可以按照我function.beta()来自定义
# ---------------------------------------------------------------------------
tbats_list = lapply(ts_list, tbats)
### same as the predicting process
tbats_pred_list = lapply(tbats_list, forecast.beta)
### calculate the devisors for RMSSE
devisors = unlist(lapply(trainData[,2:ncol(trainData)], cal.devisor))
### calculate the RMSSE for all columns (h =28)
tbats_RMSSE_v = eval.RMSSE(testData, tbats_pred_list, devisor = devisors)
### calcualte the MES for both train set and test set
tbats_RMSE_train_v = eval.RMSE(trainData, tbats_pred_list, mode = "train")
tbats_RMSE_test_v = eval.RMSE(testData, tbats_pred_list, mode = "test")
# 1.3 evaluate different h
tbats_crossH_RMSSE = data.frame()
for (h in 1:28) {
pred_list = lapply(tbats_list, forecast.beta, h = h)
tbats_RMSSE_v = eval.RMSSE(testData, tbats_pred_list, h = h, devisor = devisors)
tbats_crossH_RMSSE = rbind(tbats_crossH_RMSSE, tbats_RMSSE_v)
}
names(tbats_crossH_RMSSE) = names(tbats_RMSSE_v)
# 1.4 aggregate by item
cat_ts_list = lapply(trainAggCat[,2:ncol(trainAggCat)], msts.beta)
cat_tbats_list = lapply(cat_ts_list, tbats)
cat_tbats_pred_list = lapply(cat_tbats_list, forecast.beta)
cat_devisors = unlist(lapply(trainAggCat[,2:ncol(trainAggCat)], cal.devisor))
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, cat_pred_list, devisor = cat_devisors)
# 1.4 aggregate by store
store_ts_list = lapply(trainAggStore[,2:ncol(trainAggStore)], msts.beta)
store_tbats_list = lapply(store_ts_list, tbats)
store_tbats_pred_list = lapply(store_tbats_list, forecast.beta)
store_devisors = unlist(lapply(trainAggStore[,2:ncol(trainAggStore)], cal.devisor))
store_tbats_RMSSE_v = eval.RMSSE(testAggStore, store_pred_list, devisor = store_devisors)
# 1.5 aggregate by week
week_ts_list = lapply(trainAggWeek[,2:ncol(trainAggWeek)], msts.beta)
week_tbats_list = lapply(week_ts_list, tbats)
week_tbats_pred_list = lapply(week_tbats_list, forecast.beta, h = 4)
week_devisors = unlist(lapply(trainAggWeek[,2:ncol(trainAggWeek)], cal.devisor))
week_tbats_RMSSE_v = eval.RMSSE(testAggWeek, week_pred_list, h = 4, devisor = week_devisors)
tbats_crossH_RMSSE
h
eval.RMSSE(testData, tbats_pred_list, h = h, devisor = devisors)
tbats_crossH_RMSSE = data.frame()
lapply(tbats_list, forecast.beta, h = 1)
eval.RMSSE(testData, tbats_pred_list, h = 1, devisor = devisors)
eval.RMSSE(testData, tbats_pred_list, h = h, devisor = devisors)
eval.RMSSE(testData, tbats_pred_list, h = 27, devisor = devisors)
eval.RMSSE = function(testData, pred_list, h = 28, devisors){
testData = testData[1:h,2:ncol(testData)]
if(names(testData)!=names(pred_list))
cat("Please rearrange the pred_list\n")
else{
output = numeric()
for (i in 1:length(pred_list)) {
pred = pred_list[[i]][["mean"]]
origin = pull(testData, i)
output = c(output, cal.RMSSE(pred, origin, devisors[i]))
}
return(output)
}
}
eval.RMSSE(testData, tbats_pred_list, h = 27, devisor = devisors)
tbats_crossH_RMSSE = data.frame()
for (h in 1:28) {
pred_list = lapply(tbats_list, forecast.beta, h = h)
tbats_RMSSE_v = eval.RMSSE(testData, pred_list, h = h, devisor = devisors)
tbats_crossH_RMSSE = rbind(tbats_crossH_RMSSE, tbats_RMSSE_v)
}
names(tbats_crossH_RMSSE) = names(tbats_RMSSE_v)
<<<<<<< HEAD
View(tbats_crossH_RMSSE)
cat_ts_list = lapply(trainAggCat[,2:ncol(trainAggCat)], msts.beta)
cat_tbats_list = lapply(cat_ts_list, tbats)
cat_pred_list = lapply(cat_ts_list, forecast.beta)
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, pred_list, devisor = devisors)
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, cat_pred_list, devisor = devisors)
cat_tbats_RMSSE_v
View(testAggCat)
cat_pred_list
cat_devisors = unlist(lapply(trainAggCat[,2:ncol(trainAggCat)], cal.devisor))
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, cat_pred_list, devisor = cat_devisors)
cat_tbats_RMSSE_v
store_ts_list = lapply(trainAggStore[,2:ncol(trainAggStore)], msts.beta)
store_tbats_list = lapply(store_ts_list, tbats)
store_pred_list = lapply(store_ts_list, forecast.beta)
store_devisors = unlist(lapply(trainAggStore[,2:ncol(trainAggStore)], cal.devisor))
store_tbats_RMSSE_v = eval.RMSSE(testAggstore, store_pred_list, devisor = store_devisors)
store_tbats_RMSSE_v = eval.RMSSE(testAggStore, store_pred_list, devisor = store_devisors)
store_tbats_RMSSE_v
week_ts_list = lapply(trainAggWeek[,2:ncol(trainAggWeek)], msts.beta)
week_tbats_list = lapply(week_ts_list, tbats)
week_pred_list = lapply(week_ts_list, forecast.beta, h = 4)
week_devisors = unlist(lapply(trainAggWeek[,2:ncol(trainAggWeek)], cal.devisor))
week_tbats_RMSSE_v = eval.RMSSE(testAggWeek, week_pred_list, h = 4, devisor = week_devisors)
week_tbats_RMSSE_v
library(vars)
stability(trainAggStore[,2:ncol(trainAggStore)], type = "OLS-CUSUM")
stability(as.matrix(trainAggStore[,2:ncol(trainAggStore)]), type = "OLS-CUSUM")
class(var_cat)
stability(var_store, type = "OLS-CUSUM")
var_store_sta = stability(var_store, type = "OLS-CUSUM")
var_store_sta
polt(stability(var_store, type = "OLS-CUSUM"))
plot(stability(var_store, type = "OLS-CUSUM"))
plot(stability(var_cat, type = "OLS-CUSUM"))
plot(stability(var_all, type = "OLS-CUSUM"))
summary(stability(var_all, type = "OLS-CUSUM"))
par("mar")
par(mar = c(1,1,1,1))
plot(stability(var_all, type = "OLS-CUSUM"))
plot(stability(var_store, type = "OLS-CUSUM"))
diff(trainAggStore$CA_1)
diff(trainAggStore$CA_1) %>% length()
=======
View(rawData)
load("D:/法国学习/第一学期/forecasting/Forecasting-Group-Assignment/.RData")
View(rawData)
attributes(rowData)
Projectdata <- read.csv("Projectdata.csv")
load("D:/法国学习/第一学期/forecasting/Forecasting-Group-Assignment/.RData")
attributes(Rdata)
library(readr)
Projectdata <- read_csv("D:/法国学习/第一学期/forecasting/Forecasting-Group-Assignment/dat/Projectdata.csv")
View(Projectdata)
#Projectdata <- read.csv("Projectdata.csv")
attributes(Projectdatadata)
#Projectdata <- read.csv("Projectdata.csv")
attributes(Projectdata)
attributes(Projectdata)
library(tidyverse)
library(readr)
library(zoo)
library(forecast)
library(dplyr)
source("./R/utils.R")
source("./R/dataUtils.R")
### Dataset splition
rawData = read.csv("./dat/Projectdata.csv")
trainData = rawData[c(1:(nrow(rawData)-28)),]
testData = rawData[c((nrow(rawData)-27):nrow(rawData)),]
ts_list = lapply(trainData[,2:ncol(rawData)], msts.beta)
arima_list = lapply(ts_list, auto.arima)
pred_list = lapply(arima_list, forecast.beta)
### calculate the devisors for RMSSE
devisors = unlist(lapply(trainData[,2:ncol(trainData)], cal.devisor))
### calculate the RMSSE for all columns
arima_RMSSE_v = eval.RMSSE(testData, pred_list, devisor = devisors)
# by categories
trainAggCat = agg_by_cat(trainData)
testAggCat = agg_by_cat(testData)
# by week
trainAggWeek = agg_by_week(trainData)
testAggWeek = agg_by_week(testData)
View(ts_list)
View(ts_list)
View(ts_list)
arima_RMSSE_v
View(eval.RMSSE)
arima_list
save(arima_list, file="./arimalist/lst.RData")
save(arima_RMSSE_v, file="./arimalist/RMSSE.RData")
# by categories
trainAggCat = agg_by_cat(trainData)
testData
### Dataset splition
rawData = read.csv("./dat/Projectdata.csv")
trainData = rawData[c(1:(nrow(rawData)-28)),]
testData = rawData[c((nrow(rawData)-27):nrow(rawData)),]
# by categories
trainAggCat = agg_by_cat(trainData)
testAggCat = agg_by_cat(testData)
# by week
trainAggWeek = agg_by_week(trainData)
testAggWeek = agg_by_week(testData)
plot(pred_list)
autoplot(pred_list)
autoplot(pred_list[1:2])
plot(pred_list[1:2])
plot(pred_list[1],pred_list[2],'data','hobbies')
plot(pred_list[1],pred_list[2],'data','hobbies')%.%
mutate(pred_list[1]=as.Date(pred_list[1]))
plot(pred_list[1],pred_list[2],'data','hobbies')%.%
mutate(as.Date(pred_list[1]))
plot(pred_list[1],pred_list[2],'data','hobbies')%.%
mutate(date = as.Date(date))
View(pred_list)
plot(pred_list[["Household_1_CA_1"]])
plot(pred_list[["Household_1_CA_1"]])
View(arima_list)
View(arima_list)
View(arima_list)
View(agg_by_cat)
View(agg_by_cat)
###predict sales of items aggregated by catogories
pred_list = lapply(testAggCat, forecast.beta)
View(msts.beta)
ts.beta = function(column){
output = ts(column,start = 1, frequency = 365.25)
return(output)
}
View(forecast.beta)
View(forecast.beta)
ts365_list = lapply(trainData[,2:ncol(rawData)], ts.beta)
temp = rnorm(length(ts365_list), 0, 10)
temp = rnorm(length(ts365_list), 5, 5)
temp = rnorm(length(ts365_list), 5, 1)
temp = rnorm(length(ts365_list), 10, 5)
model = auto.arima(ts365_list, xreg = data.frame(temp = temp))
arimax_list = lapply(ts365_list, auto.arima(xreg = data.frame(temp)))
model = auto.arima(ts365_list, xreg = data.frame(temp))
arimax_list = lapply(ts365_list, auto.arima(xreg = data.frame(temp = temp)))
View(ts365_list)
xreg = as.vector(temp)
arimax_list = lapply(ts365_list, auto.arima(xreg))
model = auto.arima(ts365_list, xreg)
arimax_list = lapply(ts365_list, auto.arima(,xreg))
return(output)
auto.arima.beta = function(column){
output = auto.arima(column,xreg)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
temp = as.vector(temp)
auto.arima.beta = function(column){
output = auto.arima(column,xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
temp = rnorm(1969, 10, 5)
temp = as.vector(temp)
auto.arima.beta = function(column){
output = auto.arima(column,xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
xreg = as.vector(temp)
auto.arima.beta = function(column){
output = auto.arima(column,xreg)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column,xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column,xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
temp = rnorm(length(ts365_list), 10, 5)
temp = as.vector(temp)
auto.arima.beta = function(column){
output = auto.arima(column,xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
xreg = as.vector(temp)
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column, stepwise=FALSE,approx=FALSE, xreg=temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column, stepwise=FALSE,approx=FALSE, xregg=temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
hobby_ts_1 = msts(trainData$Hobbies_CA_1, start = 1, seasonal.periods = c(7, 30.4, 365.25))
auto.arima(hobby_ts_1,xreg = length(hobby_ts_1))
auto.arima(hobby_ts_1,xreg = rnorm(length(hobby_ts_1))
auto.arima(hobby_ts_1,xreg = rnorm(length(hobby_ts_1)))
auto.arima(hobby_ts_1,xreg = temp)
temp = rnorm(length(hobby_ts_1), 10, 5)
auto.arima(hobby_ts_1,xreg = temp)
temp.beta = function(column){
output = rnorm(length(column),10,5)
return(output)
}
auto.arima.beta = function(column){
output = auto.arima(column, xreg=temp.beta)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column, xreg)
return(output)
arimax_list = lapply(ts365_list, auto.arima.beta)
arimax_list = lapply(ts365_list, auto.arima.beta)
pred_list = lapply(arimax_list, forecast.beta)
arimax_list
arimax_list
arimax_list = lapply(ts365_list, auto.arima.beta)
arimax_list
temp = rnorm(length(ts365_list),10,5)
arimax_list = lapply(ts365_list, auto.arima.beta)
library(tidyverse)
library(readr)
library(zoo)
library(forecast)
library(dplyr)
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column, xreg)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
arimax_list = auto.arima(ts365_list,xreg)
arimax_list = auto.arima(ts365_list,xreg = unlist(xreg))
arimax_list = auto.arima(unlist(ts365_list),xreg)
temp = rnorm(length(ts365_list),10,5)
arimax_list = auto.arima(unlist(ts365_list),xreg = temp)
arimax_list = auto.arima(ts365_list,xreg = temp)
arimax_list = lapply(ts365_list, auto.arima.beta)
auto.arima.beta = function(column){
output = auto.arima(column, xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
xreg
ts365_list
View(ts365_list)
temp
temp = rnorm(1941,10,5)
auto.arima.beta = function(column){
output = auto.arima(column, xreg = temp)
return(output)
}
arimax_list = lapply(ts365_list, auto.arima.beta)
View(arimax_list)
View(arima_list)
View(arimax_list)
View(arima_list)
save(temp, file="./arimaxlist/X.RData")
save(arimax_list, file="./arimaxlist/arimaxlist.RData")
predx_list = lapply(arimax_list, forecast.beta)
###random regressors
temp.reg = data.frame(temp = rnorm(10, 10, 5))
forecastx.beta = function(model, h = 28){
output = forecast(model, level = c(95), h = h, xreg = temp.reg)
return(output)
}
predx_list = lapply(arimax_list, forecastx.beta)
###random regressors
temp.reg = rnorm(10, 10, 5))
forecastx.beta = function(model, h = 28){
output = forecast(model, level = c(95), h = h, xreg = temp.reg)
return(output)
}
predx_list = lapply(arimax_list, forecastx.beta)
###random regressors
temp.reg = rnorm(10, 10, 5)
forecastx.beta = function(model, h = 28){
output = forecast(model, level = c(95), h = h, xreg = temp.reg)
return(output)
}
predx_list = lapply(arimax_list, forecastx.beta)
View(predx_list)
View(pred_list)
save(temp.reg, file="./arimaxlist/regressor.RData")
arimax_RMSSE_v = eval.RMSSE(testData, predx_list, devisor = devisors)
View(testData)
arimax_RMSSE_v = eval.RMSSE(testData, predx_list, devisor = devisors)
plot(predx_list)
View(arima_list)
plot(pred_list)
arimax_RMSSE_v = eval.RMSSE(testData, pred_list, devisor = devisors)
### calculate the RMSSE for all columns
arima_RMSSE_v = eval.RMSSE(testData, pred_list, devisor = devisors)
library(tidyverse)
library(readr)
library(zoo)
library(forecast)
library(dplyr)
source("./R/utils.R")
source("./R/dataUtils.R")
arimax_RMSSE_v = eval.RMSSE(testData, predx_list, devisor = devisors)
### Dataset splition
rawData = read.csv("./dat/Projectdata.csv")
trainData = rawData[c(1:(nrow(rawData)-28)),]
testData = rawData[c((nrow(rawData)-27):nrow(rawData)),]
ts_list = lapply(trainData[,2:ncol(rawData)], msts.beta)
arima_list = lapply(ts_list, auto.arima)
### calculate the devisors for RMSSE
devisors = unlist(lapply(trainData[,2:ncol(trainData)], cal.devisor))
arima_list = load(file="./arimalist/lst.RData")
pred_list = lapply(arima_list, forecast.beta)
View(arimax_list)
pred_list = lapply(arima_list, forecast.beta)
ts.beta = function(column){
output = ts(column,start = 1, frequency = 365.25)
return(output)
}
auto.arima.beta = function(column){
output = auto.arima(column, xreg = temp)
return(output)
}
ts365_list = lapply(trainData[,2:ncol(rawData)], ts.beta)
arimax_list = lapply(ts365_list, auto.arima.beta)
View(arimax_list)
forecastx.beta = function(model, h = 28){
output = forecast(model, level = c(95), h = h, xreg = temp.reg)
return(output)
}
predx_list = lapply(arimax_list, forecastx.beta)
arimax_RMSSE_v = eval.RMSSE(testData, predx_list, devisor = devisors)
View(eval.RMSSE)
View(eval.RMSSE)
rm(xreg)
rm(arima_list)
rm(hobby_ts_1)
View(pred_list)
View(predx_list)
load(file="./arimalist/lst.RData")
View(arima_list)
View(arimax_list)
View(pred_list)
View(predx_list)
arimax_RMSSE_v = eval.RMSSE(testData, pred_list = predx_list, devisor = devisors)
View(testData)
View(predx_list)
View(pred_list)
### calculate the RMSSE for all columns
arima_RMSSE_v = eval.RMSSE(testData, pred_list, devisor = devisors)
>>>>>>> Stashed changes
=======
cat_tbats_RMSSE_v = eval.RMSSE(testAggCat, cat_tbats_pred_list, devisor = cat_devisors)
week_tbats_RMSSE_v = eval.RMSSE(testAggWeek, week_tbats_pred_list, h = 4, devisor = week_devisors)
tbats_RMSE_train_v
tbats_RMSE_test_v
save(ts_list, tbats_list, tbats_pred_list,
tbats_RMSSE_v, tbats_RMSE_train_v, tbats_RMSE_test_v,
tbats_crossH_RMSSE,
cat_ts_list, cat_tbats_list, cat_tbats_pred_list, cat_tbats_RMSSE_v,
store_ts_list, store_tbats_list, store_tbats_pred_list, store_tbats_RMSSE_v,
week_ts_list, week_tbats_list, week_tbats_pred_list, week_tbats_RMSSE_v,
file = "./RData/tbats.RData")
store_tbats_RMSSE_v = eval.RMSSE(testAggStore, store_tbats_pred_list, devisor = store_devisors)
week_tbats_RMSSE_v = eval.RMSSE(testAggWeek, week_tbats_pred_list, h = 4, devisor = week_devisors)
save(ts_list, tbats_list, tbats_pred_list,
tbats_RMSSE_v, tbats_RMSE_train_v, tbats_RMSE_test_v,
tbats_crossH_RMSSE,
cat_ts_list, cat_tbats_list, cat_tbats_pred_list, cat_tbats_RMSSE_v,
store_ts_list, store_tbats_list, store_tbats_pred_list, store_tbats_RMSSE_v,
week_ts_list, week_tbats_list, week_tbats_pred_list, week_tbats_RMSSE_v,
file = "./RData/tbats.RData")
>>>>>>> 93591b85bd93c80e518447fe317b510cb23415bb
